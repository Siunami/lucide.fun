<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>lucide.fun</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Production version -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    :root {
      color-scheme: light dark;
      --bg: #161618;
      --panel: #161618;
      --border: #292c30;
      --text: #e6e8eb;
      --muted: #8b939c;
      --accent: #ea384c;
      --bg-main: #191a1b; /* fallback if color-mix is unsupported */
    }
    @supports (color: color-mix(in srgb, black, white)) {
      :root { --bg-main: color-mix(in srgb, var(--bg), #fff 4%); }
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: auto; } /* custom 300ms scroll via JS */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      line-height: 1.5;
      color: var(--text);
      background: var(--bg);
    }

    a { color: inherit; text-decoration: none; }
    a:hover { text-decoration: underline; }

    .app {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
    }

    /* Sidebar */
    aside {
      border-right: 1px solid var(--border);
      background: #0e0f11;
      padding: 16px 14px;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow: auto;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    .logo {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background:
        radial-gradient(12px 12px at 30% 30%, #ff8a00, transparent 55%),
        radial-gradient(12px 12px at 70% 70%, #ff2d55, transparent 55%),
        radial-gradient(12px 12px at 70% 30%, #7c5cff, transparent 55%),
        radial-gradient(12px 12px at 30% 70%, #00d4ff, transparent 55%);
      box-shadow: 0 0 0 2px #fff1 inset;
    }

    .section-title {
      font-size: 0.8rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .06em;
      margin: 14px 8px 6px;
    }

    .nav-list {
      display: grid;
      gap: 2px;
      margin-bottom: 8px;
    }

    .nav-item {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid transparent;
      color: inherit;
      background: transparent;
      cursor: pointer;
      text-align: left;
      font: inherit;
    }
    .nav-item:hover { background: #121418; border-color: var(--border); }
    .nav-item.active {
      background: var(--panel);
      border-color: var(--border);
    }
    .count { color: var(--muted); font-variant-numeric: tabular-nums; }

    /* Main */
    main {
      padding: 20px 20px 28px;
      background: var(--bg-main);
    }

    .topbar {
      display: flex;
      align-items: center;
      gap: 12px;
      position: sticky;
      top: 0;
      background: linear-gradient(var(--bg-main), var(--bg-main));
      padding-bottom: 12px;
      z-index: 1;
    }

    .search {
      flex: 1 1 auto;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--panel);
      color: var(--text);
      outline: none;
    }
    .search::placeholder { color: var(--muted); }

    .section {
      margin: 18px 0 28px;
      scroll-margin-top: 72px;
    }
    .section h2 {
      font-size: 1.05rem;
      margin: 12px 0 4px;
    }
    .meta { color: var(--muted); margin-bottom: 12px; font-size: .95rem; }

    .icon-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
      gap: 10px;
    }
    .tile {
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 12px;
      aspect-ratio: 1;
      display: grid;
      place-items: center;
    }
    .tile i[data-lucide] { width: 24px; height: 24px; }
    .tile svg { width: 24px; height: 24px; color: #e9ecef; }

    .hidden { display: none; }

    /* Project line item inserted into grids */
    .project-line {
      grid-column: 1 / -1;
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 10px;
      padding: 12px;
      color: var(--text);
    }
    .project-line .pl-icon {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px dashed var(--border);
    }
    .project-line .pl-icon i[data-lucide] { width: 24px; height: 24px; }
    .project-line .pl-icon .name { font-weight: 600; letter-spacing: .01em; }

    .project-line .items {
        display: grid;
        gap: 4px;
    }
    .project-line .items a {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 4px 0;
        color: inherit;
    }
    .project-line .items .item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 2px 0;
        color: inherit;
    }
    .project-line .items .proj-name { font-weight: 500; }
    .project-line .items .proj-author { margin-left: auto; color: var(--muted); }

    /* Small screens */
    @media (max-width: 860px) {
      .app { grid-template-columns: 1fr; }
      aside {
        position: relative;
        height: auto;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>Lucide.fun</div>
      </div>

      <div class="section-title">View</div>
      <div class="nav-list">
        <a class="nav-item active" data-key="All" href="#all">
          <span>All</span><span class="count" id="all-count">0</span>
        </a>
      </div>

      <div class="section-title">Categories</div>
      <div id="categories" class="nav-list" role="listbox" aria-label="Categories"></div>
    </aside>

    <main>
      <div class="topbar">
        <input class="search" id="search" type="search" placeholder="Search iconsâ€¦" aria-label="Search icons">
      </div>

      <!-- All view -->
      <div id="all-view" class="section">
        <h1 style="margin:12px 0 6px;font-size:1.25rem;">All</h1>
        <div class="meta" id="all-meta"></div>
        <div id="all-grid" class="icon-grid"></div>
      </div>

      <!-- Category sections (continuous) -->
      <div id="sections"></div>
    </main>
</div>
<script src="./scripts/icon-ui.js"></script>
<script>
    // Category order mirrors the official site: https://lucide.dev/icons/categories
    // We'll fill counts from metadata at runtime.
    const CATEGORY_ORDER = [
        "Accessibility","Accounts & access","Animals","Arrows","Brands","Buildings","Charts","Communication","Connectivity","Cursors","Design","Coding & development","Devices","Emoji","File icons","Finance","Food & beverage","Gaming","Home","Layout","Mail","Mathematics","Medical","Multimedia","Nature","Navigation","Notification","People","Photography","Science","Seasons","Security","Shapes","Shopping","Social","Sports","Sustainability","Text formatting","Time & calendar","Tools","Transportation","Travel","Weather"
    ];

    const OFFSET = 72;           // sticky header offset
    const SCROLL_MS = 300;       // max scroll duration

    // Elements
    const categoriesEl = document.getElementById('categories');
    const allCountEl = document.getElementById('all-count');
    const sectionsRoot = document.getElementById('sections');
    const allView = document.getElementById('all-view');
    const allGrid = document.getElementById('all-grid');
    const allMeta = document.getElementById('all-meta');
    const search = document.getElementById('search');

    const slug = (s) =>
      s.toLowerCase()
        .replace(/&/g, 'and')
        .replace(/[^a-z0-9]+/g, '-')
        .replace(/(^-|-$)/g, '');

    // Smooth scroll with fixed max duration
    function smoothScrollToY(targetY, duration = SCROLL_MS) {
      const startY = window.pageYOffset;
      const diff = targetY - startY;
      const start = performance.now();
      const dur = Math.max(0, Math.min(duration, SCROLL_MS));
      const easeInOutQuad = (t) => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t);

      function step(now) {
        const t = Math.min(1, (now - start) / dur);
        const eased = easeInOutQuad(t);
        window.scrollTo(0, startY + diff * eased);
        if (t < 1) requestAnimationFrame(step);
        else window.scrollTo(0, targetY);
      }
      requestAnimationFrame(step);
    }

    // 1) Load metadata from local lucide-data.json
    async function loadLucideData() {
      const res = await fetch('./lucide-data.json', { cache: 'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json(); // { total, all: string[], categories: [{slug,title,icon,count,icons:[]}] }
    }

    // Load generated project URLs with author/icon/name
    async function loadProjectUrls() {
      try {
        const res = await fetch('./urls.json', { cache: 'no-store' });
        if (!res.ok) return [];
        return res.json(); // [{author, icon, name, url, description}]
      } catch {
        return [];
      }
    }

    async function loadAuthors() {
      try {
        const res = await fetch('./authors.json', { cache: 'no-store' });
        if (!res.ok) return {};
        return res.json(); // { "author name": "url" }
      } catch {
        return {};
      }
    }

    // 2) Render helpers
    function iconTile(name) {
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.innerHTML = `<i data-lucide="${name}"></i>`;
      return tile;
    }

    function projectLine(icon, items, authorUrls) {
      const div = document.createElement('div');
      div.className = 'project-line';

      const header = document.createElement('div');
      header.className = 'pl-icon';
      header.innerHTML = `<i data-lucide="${icon}"></i><div class="name">${icon}</div>`;

      const list = document.createElement('div');
      list.className = 'items';
      items.forEach(p => {
        const row = document.createElement('div');
        row.className = 'item';

        const nameA = document.createElement('a');
        nameA.className = 'proj-name';
        nameA.href = p.url || '#';
        nameA.target = '_blank';
        nameA.rel = 'noopener noreferrer';
        nameA.textContent = p.name || '';
        row.appendChild(nameA);

        const authorKey = (p && p.author ? String(p.author).toLowerCase() : '');
        const link = authorKey && authorUrls
          ? (authorUrls.get ? authorUrls.get(authorKey) : authorUrls[authorKey])
          : null;

        let authorEl;
        if (link) {
          authorEl = document.createElement('a');
          authorEl.className = 'proj-author';
          authorEl.href = link;
          authorEl.target = '_blank';
          authorEl.rel = 'noopener noreferrer';
          authorEl.textContent = p.author || '';
        } else {
          authorEl = document.createElement('span');
          authorEl.className = 'proj-author';
          authorEl.textContent = p.author || '';
        }
        row.appendChild(authorEl);

        list.appendChild(row);
      });

      div.appendChild(header);
      div.appendChild(list);
      return div;
    }

    function setActive(el) {
      document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
      el.classList.add('active');
    }

    function showAll() {
      allView.classList.remove('hidden');
      sectionsRoot.classList.add('hidden');
      const allLink = document.querySelector('.nav-item[data-key="All"]');
      if (allLink) setActive(allLink);
    }

    function showCategories() {
      sectionsRoot.classList.remove('hidden');
      allView.classList.add('hidden');
    }

    // 3) Build UI using local data
    async function init() {
      const [DATA, PROJECT_LIST, AUTHORS_OBJ] = await Promise.all([
        loadLucideData(),
        loadProjectUrls(),
        loadAuthors()
      ]);

      const CATEGORIES = Array.isArray(DATA.categories) ? DATA.categories : [];
      const TOTAL = DATA.total || (Array.isArray(DATA.all) ? DATA.all.length : 0);
      
      // Build map: icon -> projects
      const ICON_PROJECTS = new Map();
      for (const p of PROJECT_LIST) {
        const key = (p && p.icon ? String(p.icon).toLowerCase() : '');
        if (!key) continue;
        if (!ICON_PROJECTS.has(key)) ICON_PROJECTS.set(key, []);
        ICON_PROJECTS.get(key).push(p);
      }

      // Build map: author -> url (lowercased)
      const AUTHOR_URLS = new Map();
      if (AUTHORS_OBJ && typeof AUTHORS_OBJ === 'object') {
        for (const [name, url] of Object.entries(AUTHORS_OBJ)) {
          AUTHOR_URLS.set(String(name).toLowerCase(), String(url));
        }
      }

      // Sidebar (from data.categories)
      for (const cat of CATEGORIES) {
        const a = document.createElement('a');
        a.className = 'nav-item';
        a.href = `#${cat.slug}`;
        a.setAttribute('data-key', cat.title);
        a.innerHTML = `<span>${cat.title}</span><span class="count">${(cat.count || cat.icons?.length || 0).toLocaleString()}</span>`;
        categoriesEl.appendChild(a);
      }

      // All count
      allCountEl.textContent = TOTAL.toLocaleString();

      // Sections (continuous)
      const frag = document.createDocumentFragment();
      for (const cat of CATEGORIES) {
        const id = cat.slug;
        const icons = Array.isArray(cat.icons) ? cat.icons : [];

        const sec = document.createElement('section');
        sec.className = 'section';
        sec.id = id;

        const h = document.createElement('h2');
        h.textContent = cat.title;

        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.textContent = `${(cat.count || icons.length).toLocaleString()} icon(s)`;

        const grid = document.createElement('div');
        grid.className = 'icon-grid';

        const tiles = document.createDocumentFragment();
        icons.forEach(name => {
          const items = ICON_PROJECTS.get(String(name).toLowerCase());
          if (items && items.length) {
            tiles.appendChild(projectLine(name, items, AUTHOR_URLS)); // break the grid at this position
          } else {
            tiles.appendChild(iconTile(name));           // otherwise render the icon
          }
        });
        grid.appendChild(tiles);

        sec.appendChild(h);
        sec.appendChild(meta);
        sec.appendChild(grid);
        frag.appendChild(sec);
      }
      sectionsRoot.appendChild(frag);

      // All view
      allMeta.textContent = `${TOTAL.toLocaleString()} icon(s)`;
      const allFrag = document.createDocumentFragment();
      (DATA.all || []).forEach(name => {
        const items = ICON_PROJECTS.get(String(name).toLowerCase());
        if (items && items.length) {
          allFrag.appendChild(projectLine(name, items, AUTHOR_URLS)); // render once as a line item
        } else {
          allFrag.appendChild(iconTile(name));           // otherwise render the icon tile
        }
      });
      allGrid.appendChild(allFrag);

      // Render the actual SVGs
      if (window.lucide && typeof window.lucide.createIcons === 'function') {
        window.lucide.createIcons();
      }
      if (window.IconUI && typeof window.IconUI.init === 'function') window.IconUI.init();

      // Sidebar click handlers with 300ms scroll
      document.querySelectorAll('.nav-item').forEach(link => {
        link.addEventListener('click', (e) => {
          const href = link.getAttribute('href') || '';
          if (!href.startsWith('#')) return;
          e.preventDefault();
          const id = href.slice(1);

          if (id === 'all') {
            showAll();
            setActive(link);
            smoothScrollToY(0, 200);
          } else {
            showCategories();
            const el = document.getElementById(id);
            if (el) {
              setActive(link);
              const y = el.getBoundingClientRect().top + window.pageYOffset - OFFSET;
              smoothScrollToY(y, SCROLL_MS);
            }
          }
        });
      });

      // Active tracking when scrolling in category view
      const map = new Map(); // id -> link
      document.querySelectorAll('.nav-item').forEach(a => {
        const hash = a.getAttribute('href') || '';
        if (hash.startsWith('#') && hash !== '#all') map.set(hash.slice(1), a);
      });
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && sectionsRoot && !sectionsRoot.classList.contains('hidden')) {
            const id = entry.target.id;
            const link = map.get(id);
            if (link) setActive(link);
          }
        });
      }, { threshold: 0.4 });
      document.querySelectorAll('.section').forEach(sec => observer.observe(sec));

      // Search: match category title or slug; clearing shows All
      search.addEventListener('input', () => {
        const q = search.value.trim().toLowerCase();
        if (!q) {
          showAll();
          smoothScrollToY(0, 150);
          return;
        }
        const match = CATEGORIES.find(c =>
          c.title.toLowerCase().includes(q) || c.slug.includes(q)
        );
        if (match) {
          const id = match.slug;
          const link = document.querySelector(`.nav-item[href="#${id}"]`);
          if (link) setActive(link);
          showCategories();
          const el = document.getElementById(id);
          if (el) {
            const y = el.getBoundingClientRect().top + window.pageYOffset - OFFSET;
            smoothScrollToY(y, SCROLL_MS);
          }
        }
      });

      // Default to "All" view
      showAll();
    }

    init().catch(err => {
      console.error(err);
      allMeta.textContent = 'Failed to load Lucide icons.';
    });
  </script>
</body>
</html>